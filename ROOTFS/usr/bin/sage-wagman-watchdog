#!/bin/bash

GPIO_EXPORT=$(awk -F "= " '/gpio-export/ {print $2}' /etc/sage/config.ini)
PIN=$(awk -F "= " '/gpio-pin/ {print $2}' /etc/sage/config.ini)
SLEEPTIME=$(awk -F "= " '/watchdog-sec/ {print $2}' /etc/sage/config.ini)

GPIODIR="/sys/class/gpio/gpio${GPIO_EXPORT}"

if [ ! -d "$GPIODIR" ]; then

        echo "Activating GPIO pin ${PIN} with export number ${GPIO_EXPORT}."
        echo ${GPIO_EXPORT} > /sys/class/gpio/export
	
fi

echo "out" > /sys/class/gpio/gpio${GPIO_EXPORT}/direction
echo 1 > /sys/class/gpio/gpio${GPIO_EXPORT}/value

echo "GPIO pin ${PIN} active"
sleep $SLEEPTIME

echo 0 > /sys/class/gpio/gpio${GPIO_EXPORT}/value

echo "GPIO pin ${PIN} deactivated"

echo "Pinged GPIO pin ${PIN} with export number ${GPIO_EXPORT}."
